<!DOCTYPE html>
<html lang="en">
	<head>
		<title>ConstraintJS</title>
		<link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css">
		<link rel="stylesheet" href="style/stylesheet.css">
		<link rel="stylesheet" href="style/index_style.css">
		<link href="resources/google-code-prettify/sunburst.css" type="text/css" rel="stylesheet" />
		<link rel="icon" type="image/png" href="resources/cjs_logo_64.png" />
	</head>
	<body>
		<div class="container">
			<header class="keystone row">
				<div class="col-md-3">
					<img id="cjs_logo" src="resources/cjs_logo_256.png" title="ConstraintJS"/>
				</div>
				<div class="col-md-9">
					<h2 class='hidden-sm hidden-xs'><span class='cjs_name'>ConstraintJS</span> is a library for creating dynamic web apps</h2>
				</div>
			</header>
			<div class="biginfo row">
				<div class="col-md-3 mainlinks">
					<div class="row">
						<div class="col-md-12">
                    		<a href="builds/constraintjs-0.9.6.zip" class="btn btn-block btn-lg btn-primary"><span class="glyphicon glyphicon-download"></span> Download <span class="version">v0.9.6</span></a>
							<div class="filesize">10kb minified &amp; gzipped</div>
						</div>
					</div>
					<div class="row">
						<div class="col-xs-6">
                    		<a target="_blank" href="https://github.com/soney/constraintjs" class="btn btn-block btn-link"><span class="glyphicon glyphicon-wrench"></span> Github</a>
						</div>
						<div class="col-xs-6">
							<a target="tut" href="https://github.com/soney/ConstraintJS/wiki" class="btn btn-block btn-link"><span class="glyphicon glyphicon-book"></span> Tutorial</a>
						</div>
						<div class="col-xs-6">
							<a href="api/" class="btn btn-block btn-link"><span class="glyphicon glyphicon-list"></span> API</a>
						</div>
					</div>
				</div>
				<div class="col-md-3 col-sm-4 desc">
					<h4>Cleaner code</h4>
					<p>ConstraintJS enables <em>constraints</em> &mdash; relationships that are declared once &amp; automatically maintained. These constraints can make writing dynamic apps easier.</p>
				</div>
				<div class="col-md-3 col-sm-4 desc">
					<h4>Lightweight</h4>
					<p>ConstraintJS is small (about 10kb) and works well with other JavaScript libraries like jQuery.</p>
				</div>
				<div class="col-md-3 col-sm-4 desc">
					<h4>Simple syntax</h4>
					<p>ConstraintJS's API is very learnable and includes features for dynamic handlebars-like templates.</p>
				</div>
			</div>
			<div class="panel panel-default">
				<div class="panel-heading"><h4>Examples: Live Handlebars Templates</h4></div>
				<div class="panel-body">
					<p>ConstraintJS includes a Handlebars-like templating syntax. Unlike Handlebars templates, these templates are <em>live</em>&mdash;DOM nodes are created, moved, and removed dynamically without modifying other page elements. See <a href="api/#cjs_createTemplate">the API documentation</a> for more details.</p>
				</div>
				<table class="table">
					<thead>
						<tr>
							<th>Code (Templated HTML &amp; JavaScript)</th>
							<th>Output</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>
								<pre id="ex1_disp" class="prettyprint"></pre>
<pre id="ex1_js" class="prettyprint">
cjs.createTemplate(ex1_code, {libName: cjs}); // use template above
</pre>
							</td>
							<td id="ex1"></td>
						</tr>
						<tr>
							<td>
								<pre id="ex2_disp" class="prettyprint"></pre>
<pre id="ex2_js" class="prettyprint">
// works with jQuery ($)
cjs.createTemplate($("#ex2code"), {}, $("#ex2"));</pre>
							</td>
							<td id="ex2"></td>
						</tr>
					</tbody>
				</table>
			</div>

			<div class="panel panel-default">
				<div class="panel-heading"><h4>Example: Dynamic JavaScript</h4></div>
				<div class="panel-body">
					<p>ConstraintJS can also enhance lower-level JavaScript by making it easier to create developer-specified bindings between constraint variables and DOM elements. ConstraintJS gives developers a low-level API to create behaviors of any complexity.</p>
				</div>
				<table class="table">
					<thead>
						<tr>
							<th>Code (JavaScript)</th>
							<th>Output</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>
<label>sliderTemplate:</label>
<pre id="ex3_slider" class="prettyprint"></pre>
<label>eyeTemplate:</label>
<pre id="ex3_eye" class="prettyprint"></pre>
<pre id="ex3_disp" class="prettyprint">
var eradius_slider = sliderTemplate({max: 90, min: 10, val: 50}),
	eye_radius     = cjs(eradius_slider).toInt(),
	pradius_slider = sliderTemplate({max: 90, min: 10, val: 20}),
	pupil_radius   = cjs(pradius_slider).min(eye_radius),

	mouse_x = cjs(0),
	mouse_y = cjs(0);

var eyes = (['left', 'right']).map(function(float) {
	var eye   = eyeTemplate({fill: "white", size: eye_radius.mul(2), float: float}),
		pupil = eyeTemplate({fill: "black", size: pupil_radius.mul(2), float: ""}),

		eye_pos = cjs(function() { return $(eye).position(); }),
		dx = eye_pos.prop("left").add(eye_radius).sub(mouse_x),
		dy = eye_pos.prop("top").add(eye_radius).sub(mouse_y),
		d  = dx.pow(2).add(dy.pow(2)).sqrt().min(eye_radius.sub(pupil_radius)),
		angle    = dy.atan2(dx),
		eye_left = eye_radius.sub(pupil_radius, d.mul(angle.cos())),
		eye_top  = eye_radius.sub(pupil_radius, d.mul(angle.sin()));

	cjs.bindCSS(pupil, {
			position: "relative",
			left: eye_left.add("px"),
			top: eye_top.add("px")
		});
	
	eye.appendChild(pupil);

	$(window).on("scroll resize mouseup", function(event) { eye_pos.invalidate(); });

	return eye;
});

$(window).on("mousemove", function(event) {
	mouse_x.set(event.pageX); mouse_y.set(event.pageY);
});
</pre>
							</td>
							<td id="ex3"></td>
						</tr>
					</tbody>
				</table>
			</div>
			<footer class="row">
				<div class="col-md-12">
					<iframe class='pull-left' src="https://ghbtns.com/github-btn.html?user=soney&repo=constraintjs&type=watch" allowtransparency="true" frameborder="0" scrolling="0" width="62" height="20"></iframe>
					<iframe class='pull-left' src="https://ghbtns.com/github-btn.html?user=soney&repo=constraintjs&type=fork" allowtransparency="true" frameborder="0" scrolling="0" width="62" height="20"></iframe>
					<p class="pull-right">Created by <a href="https://from.so">Stephen Oney</a> as part of the <a href="http://www.cs.cmu.edu/~NatProg/">CMU Natural Programming Group</a>. Code licensed under the <a target="license" href="https://github.com/soney/constraintjs/blob/master/LICENSE">MIT License</a>.</p>
				</div>
			</footer>
		</div> <!-- /container -->
        
		<script src="builds/constraintjs-latest/cjs.min.js"></script>
		<script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
		<script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>
		<script type="cjs/template" id="ex1code">
<label>Name:</label>
<input class='form-control' type='text' cjs-out='name'
		placeholder='Enter your name' />

<h3>Hello, {{name||'friend'}}!</h3>
<h4>I am {{libName}}</h4>
		</script>
		<script type="cjs/template" id="ex2code">
<label>Title:</label>
<input class='form-control' type='text' cjs-out='demonym'
		placeholder='Demonym' value='Commander' />

<label>Members (comma-separated):</label>
<input class='form-control' type='text' cjs-out='items'
		placeholder='Comma-separated items'
		value='Kirk, Spock, Sulu, Uhura' />

<hr /> <label>Result:</label>

<ul class="list-group">  
	{{#each items.split(",")}}
		<li class="list-group-item">
			<strong>{{demonym}} {{@index}}</strong>: {{this}}
		</li>
	{{/each}}
</ul>
		</script>
<script type="cjs/template" id="slider_template">
<input type='range' max={{max}} min={{min}} value={{val}} />
</script>
<script type="cjs/template" id="eye_template">
<span class='eye' style='background-color: {{fill}}; width:{{size}}px; height:{{size}}px;
	border: 2px solid black; display: block; border-radius: {{size}}px; float:{{float}}'></span>
</script>
		<script type="text/javascript">	

			
			$(function() {
			cjs.createTemplate(document.getElementById("ex1code"), {libName: cjs}, document.getElementById("ex1"));
			$("#ex1_disp").text($("#ex1code").text().trim());
			
			cjs.createTemplate($("#ex2code"), {}, $("#ex2"));
			$("#ex2_disp").text($("#ex2code").text().trim());
			
			$("#ex3_slider").text($("#slider_template").text().trim());
			$("#ex3_eye").text($("#eye_template").text().trim());

			try{
			var sliderTemplate = cjs.createTemplate($("#slider_template")),
				eyeTemplate    = cjs.createTemplate($("#eye_template")),
				eradius_slider = sliderTemplate({max: 90, min: 15, val: 50}),
				eye_radius     = cjs(eradius_slider).toInt(),
				pradius_slider = sliderTemplate({max: 90, min: 15, val: 20}),
				pupil_radius   = cjs(pradius_slider).min(eye_radius),

				mouse_x = cjs(0),
				mouse_y = cjs(0),

			eyes = (['left', 'right']).map(function(float) {
				var eye = eyeTemplate({fill: "white", size: eye_radius.mul(2), float: float}),
					pupil = eyeTemplate({fill: "black", size: pupil_radius.get()*2, float: ""}),

					eye_pos = cjs(function() { return $(eye).position(); }),
					dx = eye_pos.prop("left").add(eye_radius).sub(mouse_x),
					dy = eye_pos.prop("top").add(eye_radius).sub(mouse_y),
					d  = dx.pow(2).add(dy.pow(2)).sqrt().min(eye_radius.sub(pupil_radius)),
					angle = dy.atan2(dx),
					eye_left = eye_radius.sub(pupil_radius, d.mul(angle.cos())),
					eye_top  = eye_radius.sub(pupil_radius, d.mul(angle.sin()));
				cjs.bindCSS(pupil, {
						position: "relative",
						left: eye_left.add("px"),
						top: eye_top.add("px"),
						width: pupil_radius.mul(2).add("px"),
						height: pupil_radius.mul(2).add("px"),
						"border-radius": pupil_radius.mul(2).add("px")
					});
				
				eye.appendChild(pupil);

				$(window).on("scroll resize mouseup mousemove", function(event) { eye_pos.invalidate(); });

				return eye;
			});
			cjs.bindCSS($("#ex3"), "width", eye_radius.mul(4).add(20, "px"));

			$(window).on("mousemove", function(event) {
					mouse_x.set(event.pageX); mouse_y.set(event.pageY);
				}).on("touchstart touchend", function(event) {
					mouse_x.set(event.originalEvent.touches[0].pageX); mouse_y.set(event.originalEvent.touches[0].pageY);
			});

				$("#ex3")	.append("<label style='text-align:right;width:100%'>Eye radius: </label>", $("<div style='text-align: right' />").append(eradius_slider))
				.append("<label style='text-align:right;width:100%'>Pupil radius: </label>", $("<div style='text-align: right' />").append(pradius_slider))
						//.append(pupil)
						.append(eyes).css("overflow-x", "none");
			} catch(e){}
				prettyPrint();
				$("#ex1 input").val("friend").select().focus();
			});
		</script>
		<script type="text/javascript" src="resources/google-code-prettify/prettify.js"></script>
	</body>
</html>
